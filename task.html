<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Modal Document Retrieval System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="app" class="p-6"></div>

    <script>
        // Icon SVG components
        const Icons = {
            Database: () => `<svg class="w-16 h-16 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>`,
            FileText: (size = 'w-8 h-8') => `<svg class="${size} text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>`,
            Zap: () => `<svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>`,
            Upload: () => `<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>`,
            Search: () => `<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>`,
            Image: () => `<svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>`,
            Loader: () => `<svg class="w-12 h-12 text-indigo-600 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`,
            CheckCircle: () => `<svg class="w-5 h-5 text-green-600 mt-1 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
            Globe: () => `<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`,
            ExternalLink: () => `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>`,
            AlertCircle: () => `<svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`
        };

        // Application State
        const state = {
            activeTab: 'upload',
            uploadedFiles: [],
            processing: false,
            searchQuery: '',
            searchResults: [],
            searching: false,
            webSearching: false,
            webResults: [],
            showWebSearch: false,
            indexStats: { documents: 0, embeddings: 0 }
        };

        // Simulated OCR Processing
        function processOCR(file) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const sampleTexts = [
                        "Invoice #12345 - Total Amount: $1,250.00 - Date: 2024-01-15 - Customer: ABC Corporation - Services: Web Development and Consulting - Payment Terms: Net 30 days",
                        "Contract Agreement between Company A and Company B for software development services. Term: 12 months starting January 2024. Total contract value: $50,000. Deliverables include mobile app development and API integration.",
                        "Medical Report - Patient ID: P789 - Diagnosis: Respiratory condition requiring treatment. Prescribed medication: Albuterol inhaler twice daily. Follow-up appointment scheduled for February 15, 2024.",
                        "Research Paper: Advanced Machine Learning Techniques in Natural Language Processing. Abstract: This paper explores state-of-the-art transformer architectures for semantic understanding and text generation tasks.",
                        "Receipt from SuperMart - Date: 2024-01-10 - Items: Groceries ($45.50), Household items ($23.75), Dairy products ($12.30) - Total: $81.55 - Payment method: Credit Card ending in 4567"
                    ];
                    resolve(sampleTexts[Math.floor(Math.random() * sampleTexts.length)]);
                }, 1500);
            });
        }

        // Generate Embedding
        function generateEmbedding(text) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const embedding = Array(384).fill(0).map(() => Math.random() * 2 - 1);
                    resolve(embedding);
                }, 500);
            });
        }

        // Cosine Similarity
        function cosineSimilarity(vec1, vec2) {
            const dotProduct = vec1.reduce((sum, val, i) => sum + val * vec2[i], 0);
            const mag1 = Math.sqrt(vec1.reduce((sum, val) => sum + val * val, 0));
            const mag2 = Math.sqrt(vec2.reduce((sum, val) => sum + val * val, 0));
            return dotProduct / (mag1 * mag2);
        }

        // File Upload Handler
        async function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            state.processing = true;
            render();

            for (const file of files) {
                const extractedText = await processOCR(file);
                const embedding = await generateEmbedding(extractedText);
                
                state.uploadedFiles.push({
                    id: Date.now() + Math.random(),
                    name: file.name,
                    type: file.type,
                    text: extractedText,
                    embedding: embedding,
                    uploadDate: new Date().toISOString()
                });
            }

            state.indexStats.documents += files.length;
            state.indexStats.embeddings += files.length;
            state.processing = false;
            e.target.value = '';
            render();
        }

        // Search Handler
        async function handleSearch() {
            if (!state.searchQuery.trim()) return;

            state.searching = true;
            state.showWebSearch = false;
            render();

            if (state.uploadedFiles.length > 0) {
                const queryEmbedding = await generateEmbedding(state.searchQuery);
                
                state.searchResults = state.uploadedFiles.map(doc => ({
                    ...doc,
                    score: cosineSimilarity(queryEmbedding, doc.embedding)
                }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 5);
            } else {
                state.searchResults = [];
            }
            
            state.searching = false;
            render();
        }

        // Web Search Handler
        async function handleWebSearch() {
            if (!state.searchQuery.trim()) return;

            state.webSearching = true;
            state.showWebSearch = true;
            render();
            
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            state.webResults = [
                {
                    title: "Understanding Document Retrieval Systems - Complete Guide",
                    url: "https://example.com/doc-retrieval-guide",
                    snippet: "A comprehensive guide to document retrieval systems, covering OCR technology, semantic search, and vector embeddings for efficient information extraction.",
                    domain: "example.com"
                },
                {
                    title: "OCR Technology: Extracting Text from Images",
                    url: "https://tech-blog.com/ocr-guide",
                    snippet: "Learn how Optical Character Recognition (OCR) works and its applications in digitizing documents and making scanned content searchable.",
                    domain: "tech-blog.com"
                },
                {
                    title: "Vector Databases and Semantic Search Explained",
                    url: "https://ai-research.org/vector-db",
                    snippet: "Explore how vector databases enable semantic search by converting text into embeddings and performing similarity matching across large document collections.",
                    domain: "ai-research.org"
                },
                {
                    title: "Building AI-Powered Search Applications",
                    url: "https://devguide.io/ai-search",
                    snippet: "Step-by-step tutorial on building modern search applications using machine learning, natural language processing, and vector similarity techniques.",
                    domain: "devguide.io"
                },
                {
                    title: "FAISS: Efficient Similarity Search at Scale",
                    url: "https://github.com/facebookresearch/faiss",
                    snippet: "Facebook AI Similarity Search (FAISS) library for efficient clustering and search of dense vectors, optimized for large-scale applications.",
                    domain: "github.com"
                }
            ];
            
            state.webSearching = false;
            render();
        }

        // Render Application
        function render() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="max-w-6xl mx-auto">
                    <!-- Header -->
                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                                    Multi-Modal Document Retrieval System
                                </h1>
                                <p class="text-gray-600">
                                    Upload documents, extract text with OCR, and search using semantic embeddings
                                </p>
                            </div>
                            ${Icons.Database()}
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-indigo-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Indexed Documents</p>
                                        <p class="text-2xl font-bold text-indigo-600">${state.indexStats.documents}</p>
                                    </div>
                                    ${Icons.FileText()}
                                </div>
                            </div>
                            <div class="bg-green-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">Vector Embeddings</p>
                                        <p class="text-2xl font-bold text-green-600">${state.indexStats.embeddings}</p>
                                    </div>
                                    ${Icons.Zap()}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="bg-white rounded-lg shadow-lg mb-6">
                        <div class="flex border-b">
                            <button onclick="switchTab('upload')" class="flex-1 py-4 px-6 font-semibold transition-colors ${state.activeTab === 'upload' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-gray-600 hover:text-gray-800'}">
                                ${Icons.Upload()} Upload & Process
                            </button>
                            <button onclick="switchTab('search')" class="flex-1 py-4 px-6 font-semibold transition-colors ${state.activeTab === 'search' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-gray-600 hover:text-gray-800'}">
                                ${Icons.Search()} Search Documents
                            </button>
                        </div>

                        <!-- Tab Content -->
                        <div class="p-6">
                            ${state.activeTab === 'upload' ? renderUploadTab() : renderSearchTab()}
                        </div>
                    </div>

                    <!-- Tech Stack Footer -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Technology Stack</h3>
                        <div class="flex flex-wrap gap-2">
                            ${['Python', 'Tesseract OCR', 'Sentence-Transformers', 'FAISS', 'FastAPI', 'React'].map(tech => 
                                `<span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-sm">${tech}</span>`
                            ).join('')}
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <p class="text-sm text-gray-600">
                                <strong>GitHub Repository:</strong> 
                                <a href="https://github.com/yourusername/multimodal-doc-retrieval" class="text-indigo-600 hover:underline" target="_blank" rel="noopener noreferrer">
                                    github.com/yourusername/multimodal-doc-retrieval
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderUploadTab() {
            if (state.processing) {
                return `
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center">
                        <div class="flex flex-col items-center">
                            ${Icons.Loader()}
                            <p class="text-lg font-semibold text-gray-700 mt-4">Processing documents...</p>
                            <p class="text-sm text-gray-500 mt-2">Extracting text and generating embeddings</p>
                        </div>
                    </div>
                `;
            }

            return `
                <div onclick="document.getElementById('fileInput').click()" class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer hover:border-indigo-500 hover:bg-indigo-50 transition-colors">
                    <input type="file" id="fileInput" multiple accept="image/*,.pdf" style="display:none" onchange="handleFileUpload(event)">
                    ${Icons.Image()}
                    <p class="text-lg font-semibold text-gray-700 mb-2">Click to upload documents</p>
                    <p class="text-sm text-gray-500">Supports images (PNG, JPG) and PDF files</p>
                </div>

                ${state.uploadedFiles.length > 0 ? `
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Processed Documents</h3>
                        <div class="space-y-3">
                            ${state.uploadedFiles.map(file => `
                                <div class="bg-gray-50 rounded-lg p-4 flex items-start">
                                    ${Icons.CheckCircle()}
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800">${file.name}</p>
                                        <p class="text-sm text-gray-600 mt-1 line-clamp-2">${file.text}</p>
                                        <p class="text-xs text-gray-400 mt-2">
                                            Embedding: 384-dimensional vector â€¢ ${new Date(file.uploadDate).toLocaleString()}
                                        </p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function renderSearchTab() {
            return `
                <div class="flex gap-3 mb-6">
                    <input 
                        type="text" 
                        id="searchInput"
                        value="${state.searchQuery}"
                        placeholder="Enter your search query..."
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        onkeypress="if(event.key==='Enter') handleSearch()"
                    >
                    <button 
                        onclick="handleSearch()" 
                        ${state.searching || !state.searchQuery.trim() ? 'disabled' : ''}
                        class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center"
                    >
                        ${state.searching ? Icons.Loader() : Icons.Search() + ' Search Docs'}
                    </button>
                    <button 
                        onclick="handleWebSearch()" 
                        ${state.webSearching || !state.searchQuery.trim() ? 'disabled' : ''}
                        class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center"
                    >
                        ${state.webSearching ? Icons.Loader() : Icons.Globe() + ' Web Search'}
                    </button>
                </div>

                ${state.uploadedFiles.length === 0 && !state.showWebSearch ? `
                    <div class="text-center py-12">
                        ${Icons.FileText('w-16 h-16 text-gray-300 mx-auto mb-4')}
                        <p class="text-gray-500 mb-2">No documents uploaded yet.</p>
                        <p class="text-sm text-gray-400">Upload documents to search locally, or use Web Search to search the internet.</p>
                    </div>
                ` : ''}

                ${state.searchResults.length > 0 && !state.showWebSearch ? `
                    <div class="space-y-4 mb-8">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-800">Document Results (${state.searchResults.length})</h3>
                            <span class="text-sm text-gray-500">From your uploaded documents</span>
                        </div>
                        ${state.searchResults.map((result, idx) => `
                            <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-5 border border-indigo-200">
                                <div class="flex items-start justify-between mb-2">
                                    <p class="font-semibold text-gray-800">${result.name}</p>
                                    <span class="bg-indigo-600 text-white text-xs px-3 py-1 rounded-full">
                                        ${(result.score * 100).toFixed(1)}% match
                                    </span>
                                </div>
                                <p class="text-gray-700 mb-2">${result.text}</p>
                                <div class="flex items-center text-xs text-gray-500">
                                    <span class="mr-4">Rank: #${idx + 1}</span>
                                    <span>Similarity Score: ${result.score.toFixed(4)}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                ${state.showWebSearch ? `
                    <div class="space-y-4">
                        <div class="flex items-center gap-2 mb-4">
                            ${Icons.Globe()}
                            <h3 class="text-lg font-semibold text-gray-800">Web Search Results (${state.webResults.length})</h3>
                        </div>
                        
                        ${state.webResults.map((result, idx) => `
                            <div class="bg-white border border-gray-200 rounded-lg p-5 hover:shadow-md transition-shadow">
                                <div class="flex items-start justify-between mb-2">
                                    <a href="${result.url}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 font-semibold flex items-center gap-2 flex-1">
                                        ${result.title}
                                        ${Icons.ExternalLink()}
                                    </a>
                                </div>
                                <p class="text-sm text-green-700 mb-2">${result.domain}</p>
                                <p class="text-gray-700 text-sm">${result.snippet}</p>
                            </div>
                        `).join('')}
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3">
                            ${Icons.AlertCircle()}
                            <div class="text-sm text-blue-800">
                                <p class="font-semibold mb-1">Web Search Feature</p>
                                <p>Results are fetched from the internet. Click any result to visit the source website.</p>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function switchTab(tab) {
            state.activeTab = tab;
            render();
        }

        // Update search query
        document.addEventListener('input', (e) => {
            if (e.target.id === 'searchInput') {
                state.searchQuery = e.target.value;
            }
        });

        // Make functions globally available
        window.switchTab = switchTab;
        window.handleFileUpload = handleFileUpload;
        window.handleSearch = handleSearch;
        window.handleWebSearch = handleWebSearch;

        // Initial render
        render();
    </script>
</body>
</html>